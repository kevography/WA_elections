<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Washington State Presidential Elections</title>
  <!-- stylesheets -->
  <link rel="stylesheet" href="css/leaflet.css" />
  <link href="css/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web|Oswald" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <!-- javascript libraries -->
  <script src="js/d3.js"></script>
  <script src="js/c3.min.js"></script>
  <script src="js/leaflet.js"></script>
  <script src="js/jquery.min.js"></script>
</head>

<body>
  <!-- sidebar -->
  <div id="info">

    <div id="title">
      WA State Presidential Votes by Party
      <span><a href="https://twitter.com/UW" target="_blank"><i class="fa fa-twitter-square"></i></a></span>
      <span><a href="https://github.com/kevography/WA_elections" target="_blank"><i class="fa fa-github-square"></i></a></span>
    </div>

    <p id="placename">Washington</p>
    <div id="totalvotes">
      <span> Total Votes (2020): </span><span id="total-votes">4087631</span>
    </div>

    <h5 class="desc"> 2020 Presidential Vote Breakdown </h5>
    <div id="county-chart-proportional"></div>
    <h5 class="desc"> Presidential Vote History </h5>
    <div id="county-chart-history"></div>
<!--
    <div id="count" class="card">
      <h5 class="desc"> 2020 Presidential Votes: Democratic Nominee</h5>
      <p class="county-count" id="demvote2020">2369612</p>
      <h5 class="desc"> 2020 Presidential Votes: Republican Nominee</h5>
      <p class="county-count" id="repvote2020">1584651</p>
    </div>
-->


    <!-- <div id="footer">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
      irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet,
      consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit
      in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
      eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
      dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
    </div> -->
  </div>

  <!-- mainwindow -->
  <div id="map"></div>

  <script>
    // 1.Create a map object and set the initial view point
    var mymap = L.map('map', {
      center: [47.33, -121.93],
      zoom:7,
      maxZoom: 9,
      minZoom: 5,
      zoomControl: false,
      detectRetina: true
    });

    // 2. move the zoom control to the top right corner.
    new L.Control.Zoom({
      position: 'topright'
    }).addTo(mymap);


    // 3. Add a base map.
    L.tileLayer('assets/positron/{z}/{x}/{y}.png').addTo(mymap);

    // 4. Declare three global variables for the wa counties thematic layer, bar chart, and the organized wa data.
    var countiesLayer = null,
      bchart = null,
      pchart = null,
      counties = {};

    // 5. load all datasets through promise mechnism and store them in an array
    Promise.all([d3.json("assets/presbycnty2.geojson")]).then(function(datasets) {

      // 6. Map relevant operations

      // 6.1 create a couties layer
      countiesLayer = L.geoJSON(datasets[0], {
        onEachFeature: onEachFeature
      }).addTo(mymap);

      // 6.2 add three events to the the layer “countiesLayer”.
      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          click: clickFeature,
          mouseout: resetHighlight
        });
      }

      // 6.3 this function works when the mouse hovers over on a map feature.
      function highlightFeature(e) {
        // e indicates the current event
        var feature = e.target; //the target capture the object which the event associates with
        feature.setStyle({
          weight: 2,
          opacity: 0.8,
          color: '#e3e3e3',
          fillColor: '#000000',
          fillOpacity: 0.1
        });
      }

      // 6.4 this function executes when the mouse clicks on a map feature.
      function clickFeature(e) {

        L.DomEvent.stopPropagation(e);

        $("#placename").text(e.target.feature.properties.COUNTY_LAB + " County");
        $("#demvote2020").text(e.target.feature.properties.prz2020dem);
        $("#repvote2020").text(e.target.feature.properties.prz2020rep);
        $("#total-votes").text(e.target.feature.properties.prz2020dem+e.target.feature.properties.prz2020rep+e.target.feature.properties.prz2020lib+e.target.feature.properties.prz2020grn+e.target.feature.properties.prz2020slp+e.target.feature.properties.prz2020swp+e.target.feature.properties.prz2020wri);
        pchart = c3.generate({
        data: {
            // iris data from R
            columns: [
                ['Democratic Votes', e.target.feature.properties.prz2020dem],
                ['Republican Votes', e.target.feature.properties.prz2020rep],
                ['Libertarian Votes',e.target.feature.properties.prz2020lib],
                ['Green Votes', e.target.feature.properties.prz2020grn],
                ['Socialism and Liberation Votes', e.target.feature.properties.prz2020slp],
                ['Socialist Worker Votes', e.target.feature.properties.prz2020swp],
                ['Write-In Votes', e.target.feature.properties.prz2020wri]
            ],
            type : 'pie',
            onclick: function (d, i) { console.log("onclick", d, i); },
            onmouseover: function (d, i) { console.log("onmouseover", d, i); },
            onmouseout: function (d, i) { console.log("onmouseout", d, i); }
        },
        bindto: "#county-chart-proportional"
        });

        bchart = c3.generate({
          data: {
            columns: [
              ['Democratic Votes', e.target.feature.properties.prz2020dem,e.target.feature.properties.prz2016dem,e.target.feature.properties.prz2012dem,e.target.feature.properties.prz2008dem],
              ['Republican Votes', e.target.feature.properties.prz2020rep,e.target.feature.properties.prz2016rep,e.target.feature.properties.prz2012rep,e.target.feature.properties.prz2008rep],
              ['Libertarian Votes', e.target.feature.properties.prz2020lib,e.target.feature.properties.prz2016lib,e.target.feature.properties.prz2012lib,e.target.feature.properties.prz2008lib],
              ['Green Votes', e.target.feature.properties.prz2020grn,e.target.feature.properties.prz2016grn,e.target.feature.properties.prz2012grn,e.target.feature.properties.prz2008grn],
              ['Socialism and Liberation Votes', e.target.feature.properties.prz2020slp,e.target.feature.properties.prz2016slp,e.target.feature.properties.prz2012slp,e.target.feature.properties.prz2008slp],
              ['Socialist Worker Votes', e.target.feature.properties.prz2020swp,e.target.feature.properties.prz2016swp,e.target.feature.properties.prz2012swp,e.target.feature.properties.prz2008swp],
              ['Constitution Votes', 0, e.target.feature.properties.prz2016con,e.target.feature.properties.prz2012con,e.target.feature.properties.prz2008con],
              ['Justice Votes', 0, 0, e.target.feature.properties.prz2012jst,0],
              ['Independent Votes', 0, 0, 0, e.target.feature.properties.prz2008ind],
              ['Write-In Votes', e.target.feature.properties.prz2020wri,0,0,0],
            ],
            type: 'bar',
            groups:[
              ['Green Votes', 'Socialism and Liberation Votes', 'Socialist Worker Votes', 'Constitution Votes', 'Justice Votes', 'Independent Votes', 'Write-In Votes']
            ],
            labels: {
                format: {
                  'Democratic Votes': function(d) {return d},
                  'Republican Votes': function(d) {return d},
                  'Libertarian Votes': function(d) {return d}
                }
              },
            order:null,
          },
          axis: {
            x: {
              type: 'category',
              categories: ['2020', '2016', '2012', '2008']
            },
            y: {
              tick: {
                format: function(d) {return d/1000 + 'k'}
              }
            },
            rotated: true
          },
          padding: {
            right: 20
          },
          bindto: "#county-chart-history"
        });
      }

      // 6.5 reset the hightlighted feature when the mouse is out of its region.
      function resetHighlight(e) {
        countiesLayer.resetStyle(e.target);
      }

      // 6.6 bind the onMapClick function to the mymap object.
      mymap.on('click', onMapClick);

      // when click on any place on the map expect the counties layer, the text on the sidebar will be reset to the total number of WA.
      function onMapClick(e) {
        $("#placename").text("Washington");
        $("#demvote2020").text("2369612");
        $("#repvote2020").text("1584651");
        $("#total-votes").text("4087631");

        pchart = c3.generate({
        data: {
            // iris data from R
            columns: [
                ['Democratic Votes', 2369612],
                ['Republican Votes', 1584651],
                ['Libertarian Votes',80500],
                ['Green Votes', 18289],
                ['Socialism and Liberation Votes', 4840],
                ['Socialist Worker Votes', 2487],
                ['Write-In Votes', 27252],
            ],
            type : 'pie',
            onclick: function (d, i) { console.log("onclick", d, i); },
            onmouseover: function (d, i) { console.log("onmouseover", d, i); },
            onmouseout: function (d, i) { console.log("onmouseout", d, i); }
        },
        bindto: "#county-chart-proportional"
        });

        //Bar chart of voting history
        bchart = c3.generate({
          data: {
            columns: [
              ['Democratic Votes', 2369612,1742718,1755396,1750848],
              ['Republican Votes', 1584651,1221747,1290670,1229216],
              ['Libertarian Votes',80500,160879,42202,12728],
              ['Green Votes', 18289,58417,20928,3819],
              ['Socialism and Liberation Votes', 4840,3523,1318,705],
              ['Socialist Worker Votes', 2487,4307,1205,641],
              ['Constitution Votes', 0, 17623,8851,9432],
              ['Justice Votes', 0, 0, 4946,0],
              ['Independent Votes', 0, 0, 0, 29489],
              ['Write-In Votes', 27252,0,0,0]
            ],
            type: 'bar',
            groups: [
              ['Green Votes', 'Socialism and Liberation Votes', 'Socialist Worker Votes', 'Constitution Votes', 'Justice Votes', 'Independent Votes', 'Write-In Votes']
            ],
            labels: {
              format: {
                'Democratic Votes': function(d) {return d},
                'Republican Votes': function(d) {return d},
                'Libertarian Votes': function(d) {return d}
              }
            },
            order:null,
          },
          axis: {
            x: {
              type: 'category',
              categories: ['2020', '2016', '2012', '2008']
            },
            y: {
              tick: {
                format: function(d) {return d/1000000 + 'm'}
              }
            },
            rotated: true
          },
          padding: {
            right: 20
          },
          bindto: "#county-chart-history"
        });
      }


    });

    pchart = c3.generate({
    data: {
        // iris data from R
        columns: [
            ['Democratic Votes', 2369612],
            ['Republican Votes', 1584651],
            ['Libertarian Votes',80500],
            ['Green Votes', 18289],
            ['Socialism and Liberation Votes', 4840],
            ['Socialist Worker Votes', 2487],
            ['Write-In Votes', 27252]
        ],
        type : 'pie',
        onclick: function (d, i) { console.log("onclick", d, i); },
        onmouseover: function (d, i) { console.log("onmouseover", d, i); },
        onmouseout: function (d, i) { console.log("onmouseout", d, i); }
    },
    bindto: "#county-chart-proportional"
    });

    bchart = c3.generate({
      size: {
        height: 700
      },
      data: {
        columns: [
          ['Democratic Votes', 2369612,1742718,1755396,1750848],
          ['Republican Votes', 1584651,1221747,1290670,1229216],
          ['Libertarian Votes',80500,160879,42202,12728],
          ['Green Votes', 18289,58417,20928,3819],
          ['Socialism and Liberation Votes', 4840,3523,1318,705],
          ['Socialist Worker Votes', 2487,4307,1205,641],
          ['Constitution Votes', 0, 17623,8851,9432],
          ['Justice Votes', 0, 0, 4946,0],
          ['Independent Votes', 0, 0, 0, 29489],
          ['Write-In Votes', 27252,0,0,0]
        ],
        type: 'bar',
        groups: [
          ['Green Votes', 'Socialism and Liberation Votes', 'Socialist Worker Votes', 'Constitution Votes', 'Justice Votes', 'Independent Votes', 'Write-In Votes']
        ],
        labels: {
          format: {
            'Democratic Votes': function(d) {return d},
            'Republican Votes': function(d) {return d},
            'Libertarian Votes': function(d) {return d}
          }
        },
        order:null,
      },
      axis: {
        x: {
          type: 'category',
          categories: ['2020', '2016', '2012', '2008']
        },
        y: {
          tick: {
            format: function(d) {return d/1000000 + 'm'}
          }
        },
        rotated: true
      },
      padding: {
        right: 20
      },
      bindto: "#county-chart-history"
    });
    </script>
</body>

</html>
